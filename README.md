# 보행 이벤트 감지 시스템 (Gait Event Detector)

IMU 센서 데이터를 활용한 실시간 보행 이벤트 감지 및 시각화 시스템입니다.

## 주요 기능

### 1. 실시간 데이터 처리
- `get_data.py`와 WiFi 통신으로 IMU 센서 데이터 수신
- 수직 가속도(acc_y) 실시간 처리 및 시각화
- 100Hz 샘플링 레이트 지원

### 2. 보행 이벤트 감지
- **HS (Heel Strike)**: 발뒤꿈치 접촉 감지
  - 수직 가속도의 음의 적분 계산
  - 버터워스 필터링 (차단 주파수: 0.08 rad, 차수: 4)
  - 피크 감지 (최소 prominence: 0.1 m/s)

- **TO (Toe Off)**: 발가락 이탈 감지
  - 수직 가속도의 양의 적분 계산
  - 동일한 필터링 및 피크 감지 알고리즘 적용

### 3. 실시간 시각화
- **상단 그래프**: 수직 가속도(acc_y) 시각화
  - 빨간 원: HS 이벤트
  - 초록 사각형: TO 이벤트
  
- **하단 그래프**: 적분값 및 필터링된 신호
  - 초록선: 양의 적분 (TO 감지용)
  - 빨간선: 음의 적분 (HS 감지용)
  - 청록선: 필터링된 TO 신호
  - 자주선: 필터링된 HS 신호

### 4. 부가 기능
- 스크린샷 저장 (PNG 형식)
- 데이터 클리어 및 초기화
- 실시간 이벤트 카운터
- 디버깅 정보 출력
- 연결 상태 모니터링

## 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. IMU 센서 데이터 송신
먼저 라즈베리파이에서 `get_data.py`를 실행하여 센서 데이터를 송신합니다:
```bash
python get_data.py
```

### 3. 보행 이벤트 감지기 실행
```bash
python gait_event_detector.py
```

## 사용법

### 기본 사용 순서
1. **연결 시작**: "연결 시작" 버튼 클릭하여 IMU 센서와 연결
2. **기록 시작**: "기록 시작" 버튼 클릭하여 데이터 수집 및 분석 시작
3. **실시간 모니터링**: 그래프에서 실시간 보행 이벤트 확인
4. **스크린샷 저장**: 필요시 "스크린샷 저장" 버튼으로 결과 저장
5. **데이터 클리어**: "데이터 클리어" 버튼으로 수집된 데이터 초기화

### 설정 변경
필요에 따라 다음 설정을 조정할 수 있습니다:

#### 네트워크 설정
```python
# gait_event_detector.py 내
self.data_receiver = DataReceiver(server_ip='192.168.0.177', server_port=5000)
```

#### 필터 매개변수 조정
```python
# GaitEventDetector 클래스 내
self.cutoff_freq = 0.08 / (2 * np.pi)  # 차단 주파수
self.filter_order = 4                   # 필터 차수
self.min_prominence = 0.1               # 피크 감지 임계값
```

## 출력 파일

### 스크린샷
- `gait_acc_YYYYMMDD_HHMMSS.png`: 가속도 그래프
- `gait_integral_YYYYMMDD_HHMMSS.png`: 적분 및 필터링 그래프

### 디버깅 출력
터미널에서 실시간 디버깅 정보를 확인할 수 있습니다:
```
[DEBUG] HS 감지: 시간=12.345s, 값=0.234
[DEBUG] TO 감지: 시간=12.678s, 값=0.156
```

## 문제 해결

### 연결 문제
- IP 주소와 포트가 올바른지 확인
- 방화벽 설정 확인
- `get_data.py`가 실행 중인지 확인

### 이벤트 감지 문제
- 센서 위치가 허리(수직 방향)에 올바르게 부착되었는지 확인
- 충분한 보행 움직임이 있는지 확인
- 필터 매개변수 조정 고려

### 성능 문제
- 버퍼 크기 조정 고려
- 업데이트 주기 조정 (update_timer)

## 기술적 세부사항

### 신호 처리 알고리즘
1. **적분 계산**: 사다리꼴 규칙을 사용한 수치 적분
2. **필터링**: Butterworth 저역통과 필터
3. **피크 감지**: SciPy의 find_peaks 함수 사용

### 성능 최적화
- 슬라이딩 윈도우를 사용한 메모리 효율성
- 스레드 기반 데이터 수신으로 GUI 응답성 유지
- 제한적 디버깅 출력으로 성능 최적화

### 확장 가능성
- 다양한 IMU 센서 지원
- 추가 보행 매개변수 분석
- 데이터 저장 및 후처리 기능
- 실시간 보행 분석 지표 추가